name: Run On PR against main

on:
    pull_request:
        branches:
            - main

jobs:
    setup:
        runs-on: ubuntu-latest
        steps:
        - name: checkout code
          uses: actions/checkout@v4
          with:
            fetch-depth: 0
        - name: Python Setup
          uses: actions/setup-python@v4
          with:
            python-version: '3.12.4'
    build-schema:
        needs: setup
        runs-on: ubuntu-latest
        steps:
        - name: Build schema
          uses: ./.github/actions/build-schema
    lint:
        needs: setup
        runs-on: ubuntu-latest
        steps:
        - name: Setup python, Lint Code and test
          uses: ./.github/actions/setup_lint_and_test
    integration-tests:
        needs: setup
        runs-on: ubuntu-latest
        steps:
        - name: Integration Tests
          run: |
            make test-integration
          shell: bash